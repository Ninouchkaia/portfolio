#!/usr/bin/python
# -*- coding: utf-8 -*-

# purpose of the script : generate a single file based on the 4 summary lines found in different tables.
# that shows the ratio between fraction of each amino acid and fraction of each amino acid weighted by abundance data

#update from version5
# this version adds up 4 lines on the top of the tables generated with script version5
# 1. Sum of each amino-acid present in the tables
# 2. Fraction of the total amino-acids represented by each sum of amino-acids
# 3. Sum of each amino-acid ponderated by the corresponding abundance
# 4. Fraction of the total amino-acids represented by each sum of amino-acids ponderated by the corresponding abundance

#update from version4
# we cumulated first and second version of the mapping tables. first versions were generated with the id mapping tool from uniprot website
# second versions were generated from a mapping given by pax-db website

#update from version2
# we avoid to open twice the fasta file and find the matched uniprot id only once
# in order to reach the end of the script more rapidly (originally it took 1350 seconds for the 17 datasets > with this script : 1130 seconds)

#description of the original version
# this script reads a fasta file of proteins and counts the amino acid occurences in each protein.
# this script also reads a dataset of protein abundance data. The abundance datasets are mainly composed of 2 columns : string ID - abundance score
# this script matches the string IDs to uniprot IDs through the use of a mapping file generated with the id mapping tool from uniprot.org.
# it creates different files that serve to make a final file containing the uniprot id names of the proteins, their abundance (cf. pax-db databse), and the counts of amino acids for each protein.
# it has to be executed where the final files will be saved
# 


import timeit
start = timeit.default_timer()
import os
import sys
import re
from Bio import SeqIO # to parse the fasta file
from Bio import SeqUtils # Miscellaneous functions for dealing with sequences.
from Bio.SeqUtils import  ProtParam

# the list of the 17 datasets to be analyzed
species_list = ["10090-M.musculus", "160490-S.pyogenes", "224308-Spectral_counting_B.subtili", "267671-L.interrogans", "3702-A.thaliana", "449447-M.aeruginosa", "4896-S.pombe", "4932-S.cerevisiae", "511145-E.coli", "593117-Spectral_counting_T.gammatolerans", "6239-C.elegans", "7227-D.melanogaster", "83332-M.tuberculosis", "9031-Spectral_counting_G.gallus", "9606-H.sapiens", "9913-B.taurus", "99287-Spectral_counting_S.typhimurium"]


file_write = open("/home/nina/scripts/paxdb/abundance_datasets/tables/tables_3/table3.txt",'a+')

for species in species_list:
	print species
	file_write.write("%s\t" % species)  
	## we start by creating a list of uniprot ids that were mapped to string ids, from text files located in the folder mapping_tables 
	table = open("/home/nina/scripts/paxdb/abundance_datasets/tables/tables_2/%s_table2.txt" % species, "rU")
	table = table.readlines()
	fraction = table[2].split("\t")
	fraction_ponderee = table[4].split("\t")
	for i in range(2,22):
		ratio = float(fraction[i])/float(fraction_ponderee[i])
		file_write.write("%f\t" % ratio)
	
	file_write.write("\n")
	

	
	 



	


stop = timeit.default_timer()
print stop - start 